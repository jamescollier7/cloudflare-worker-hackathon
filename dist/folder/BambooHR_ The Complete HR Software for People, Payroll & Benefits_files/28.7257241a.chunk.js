(window.webpackJsonp=window.webpackJsonp||[]).push([[28],{"0LtH":function(e,t,n){"use strict";n.d(t,"a",function(){return g});var a=n("mj2O"),r=n.n(a),c=n("nfbA"),i=n("7SM1"),o=n("OE2q"),s=n("QtlZ"),u=n("vjCh"),l=n("Wjfv"),d=n("K7i0"),f=n("SFoa"),p=n("LVcX"),b=n("0lfv"),v=n("HPUV"),h={isFromConversationalLandingPage:!1},g=function(){var e=Object(i.a)(r.a.mark(function _callee(e){var t,n,a,i,o,u,l,d;return r.a.wrap(function _callee$(r){for(;;)switch(r.prev=r.next){case 0:if(t=Object(p.a)({},["embed","configuration"],Object(s.b)()),n=t.interactionSlugMap,a=void 0===n?{}:n,i=t.interactionTestingSlugMap,o=void 0===i?{}:i,u=e?e.substring(1).toLowerCase():null){r.next=4;break}return r.abrupt("return",!1);case 4:if(!(l=Object(b.u)(o))[u]){r.next=9;break}return r.next=8,O(e,l[u],Object(c.a)(Object(c.a)({},h),{},{isTestingConversation:!0}));case 8:return r.abrupt("return",!0);case 9:if(!(d=Object(b.u)(a))[u]){r.next=14;break}return r.next=13,O(e,d[u],h);case 13:return r.abrupt("return",!0);case 14:return r.abrupt("return",!1);case 15:case"end":return r.stop()}},_callee)}));return function fireByDriftlink(t){return e.apply(this,arguments)}}(),O=function(){var e=Object(i.a)(r.a.mark(function _callee2(e,t,n){var a;return r.a.wrap(function _callee2$(r){for(;;)switch(r.prev=r.next){case 0:return a=Object(f.f)(),r.prev=1,s.a.dispatch(Object(d.q)(e)),s.a.dispatch(Object(l.b)()),Object(u.g)(t),r.next=7,Object(v.a)();case 7:return r.next=9,Object(o.b)(t,Object(c.a)(Object(c.a)({},n),{},{locale:a,goToConversation:!0}),e);case 9:r.next=14;break;case 11:r.prev=11,r.t0=r.catch(1),Object(b.n)({data:["Failed to activate drift link ".concat(e,":").concat(t),r.t0]});case 14:case"end":return r.stop()}},_callee2,null,[[1,11]])}));return function activateDriftLink(t,n,a){return e.apply(this,arguments)}}()},"1kux":function(e,t,n){"use strict";n.d(t,"a",function(){return d});var a=n("mj2O"),r=n.n(a),c=n("7SM1"),i=n("QtlZ"),o=n("ILQF"),s=n("xwTo"),u=n("2XY6"),l=n("LVcX"),d=function(){var e=Object(c.a)(r.a.mark(function _callee(){var e,t,n,a,c;return r.a.wrap(function _callee$(r){for(;;)switch(r.prev=r.next){case 0:if(e=Object(i.b)(),t=Object(l.a)(!1,["embed","configuration","theme","soundNotificationEnabled"],e),n=Object(l.a)(!1,["embed","configuration","theme","notificationOnFirstVisitOnlyEnabled"],e),a=Object(u.c)(e),c=Object(s.a)(e)||null,!t){r.next=8;break}return r.next=8,Object(o.a)({topic:"play-host-notification",message:{chatOpen:a,notificationOnFirstVisitOnly:n,activeConversationId:c}});case 8:case"end":return r.stop()}},_callee)}));return function playSoundNotification(){return e.apply(this,arguments)}}()},"2AO3":function(e,t,n){"use strict";n.r(t);var a=n("mj2O"),r=n.n(a),c=n("7SM1"),i=n("Rqwx"),o=n("QtlZ"),s=n("Bjre"),u=n("ILQF"),l=n("K7i0"),d=n("ERkP"),f=n.n(d),p=n("vTYT"),b=n("ADGC"),v=function forceComposerFocus(){if(Object(b.a)()){var e=document.querySelector("textarea.drift-widget-input:focus");e&&setTimeout(function(){var t=e.value;e.value=" ",e.value=t},50)}},h=n("SkRI"),g=n("Cpup"),O=n("HSQL");o.a.name=p.d.CONTROLLER;var m=Object(d.lazy)(Object(c.a)(r.a.mark(function _callee(){return r.a.wrap(function _callee$(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Object(h.a)(function(){return Promise.all([n.e(0),n.e(4),n.e(1),n.e(3),n.e(35)]).then(n.bind(null,"SrLZ"))}));case 1:case"end":return e.stop()}},_callee)})));t.default=function ChatPage(){return Object(d.useEffect)(function(){Object(u.c)({topic:"CONDUCTOR:action-from-plugin",handler:function handler(e){var t=e.data,n=void 0===t?{}:t;o.a.dispatch(Object(g.a)({type:n.action,payload:n.payload}))}}),Object(u.c)({topic:"parent-scroll",handler:v}),Object(s.b)({topic:"syncSendMessage",handler:function handler(e){o.a.dispatch(Object(l.w)({message:e}))}}),Object(s.b)({topic:"syncReceiveMessageSent",handler:function handler(e){o.a.dispatch(Object(l.v)(e))}}),Object(O.a)("WIDGET_CHAT_FRAME.start")},[]),f.a.createElement(d.Suspense,{fallback:f.a.createElement(i.a,null)},f.a.createElement(m,null))}},"B/Mr":function(e,t,n){"use strict";n.r(t);var a=n("QtlZ"),r=n("2AO3"),c=n("Rqwx"),i=n("9gQL"),o=n("ILQF"),s=n("ERkP"),u=n.n(s),l=n("uDfI"),d=n("uiOv"),f=n("vTYT"),p=n("Cpup");a.a.name=f.d.CONTROLLER;var b=Object(d.a)(function LandingPage(){return Object(s.useEffect)(function(){Object(o.c)({topic:"CONDUCTOR:action-from-plugin",handler:function handler(e){var t=e.data,n=void 0===t?{}:t;a.a.dispatch(Object(p.a)({type:n.action,payload:n.payload}))}})},[]),u.a.createElement(l.a,{store:a.a},u.a.createElement(s.Suspense,{fallback:u.a.createElement(c.a,null)},u.a.createElement(i.a,null)))}),v=n("mj2O"),h=n.n(v),g=n("7SM1"),O=n("s8DI"),m=n("4yhJ"),j=n("m+ej"),_=n("7HSs"),k=n("j/hj"),x=n("Qmxn"),y=n("Zulv"),w=n("pvgo"),C=n("qwiD"),S=n("OA1u"),E=n("JBtm"),I=n.n(E),T=n("SWQ0"),A=n("0lfv"),L=n("VYE+"),P=n("wNJw"),M=n("4c+F"),R=n("0LtH"),D=n("HSQL"),V=n("EQxi");n("z8n0");a.a.name=f.d.CONTROLLER;var N=Object(d.a)(function WidgetControllerPage(e){var t=e.location,n=Object(s.useState)(!1),r=Object(O.a)(n,2),c=r[0],i=r[1],l=Object(V.f)(I.a.parse(t.search)),d=Object(A.w)();return Object(s.useEffect)(function(){Object(P.a)(T.a.CHATWIDGET_READY)},[]),Object(s.useEffect)(function(){if(c){var e=Object(D.b)("widget_core:widget_loaded");e&&(Object(M.d)("loaded",e),Object(M.a)("widget.v2.load",!1))}else Object(j.a)(),Object(m.a)(),Object(o.c)({topic:"CONDUCTOR:send-usage-metric-event",handler:function(){var e=Object(g.a)(h.a.mark(function _callee(e){var t;return h.a.wrap(function _callee$(n){for(;;)switch(n.prev=n.next){case 0:return t=e.data,n.next=3,Object(M.c)(t.name,t.attributes,t.publishImmediately);case 3:case"end":return n.stop()}},_callee)}));return function handler(t){return e.apply(this,arguments)}}()}),Object(o.c)({topic:"trigger-api-event",handler:k.b}),Object(o.c)({topic:"log-conductor-error",handler:function handler(e){var t=e.data,n=void 0===t?{}:t;return Object(A.f)(new Error("WIDGET_CONDUCTOR: ".concat(n.message)))}}),Object(o.c)({topic:"get-ready-payload",handler:w.c}),Object(o.c)({topic:"identity-provided-email",handler:function handler(e){var t=e.data,n=void 0===t?{}:t;a.a.dispatch(Object(C.m)(n.email))}}),Object(o.c)({topic:"identity-provided",handler:function handler(e){var t=e.data,n=void 0===t?{}:t;a.a.dispatch(Object(C.o)(n))}}),Object(o.c)({topic:"hide-widget-on-ready",handler:function handler(){a.a.dispatch(Object(S.e)(!0))}}),Object(o.c)({topic:"show-widget-on-ready",handler:function handler(e){e.data,a.a.dispatch(Object(S.c)(!0))}}),Object(o.c)({topic:"identity-provided-id",handler:function handler(e){var t=e.data,n=void 0===t?{}:t;a.a.dispatch(Object(C.n)(n.externalId))}}),Object(o.c)({topic:"identity-provided-jwt",handler:function handler(e){var t=e.data,n=void 0===t?{}:t;a.a.dispatch(Object(C.p)(n.userJwt))}}),Object(o.c)({topic:"host-hash-change",handler:function handler(e){var t=e.data;return Object(R.a)(t.hash)}}),Object(o.c)({topic:"debug-init",handler:x.b}),Object(o.c)({topic:"init-ready",handler:function(){var e=Object(g.a)(h.a.mark(function _callee2(){var e;return h.a.wrap(function _callee2$(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,(e=Object(V.g)(l[f.a.PAGE_URL]))&&e.length>1500&&(e=null),t.t0=!c,!t.t0){t.next=7;break}return t.next=7,Object(y.b)({embedId:l.embedId,params:{skipCampaigns:l.skipCampaigns,forceShow:l.forceShow,session:{sessionId:l.sessionId,sessionStarted:l.sessionStarted,campaignRefreshToken:l.campaignRefreshToken,instanceId:d},timing:{pageLoadStartTime:l.pageLoadStartTime},mode:l.mode,parentUrl:e}});case 7:i(!0),t.next=13;break;case 10:t.prev=10,t.t1=t.catch(0),console.warn(t.t1);case 13:case"end":return t.stop()}},_callee2,null,[[0,10]])}));return function handler(){return e.apply(this,arguments)}}()}),Object(o.c)({topic:"get-cookie-domains",handler:function handler(){return Object(L.c)()}}),Object(P.a)(T.b.API_READY)},[l.embedId,l.forceShow,l.skipCampaigns,c,l.sessionId,l.sessionStarted,l.campaignRefreshToken,d,l.pageLoadStartTime,l.mode,l]),c?u.a.createElement(_.a,null):u.a.createElement(u.a.Fragment,null)});t.default=function WidgetPage(e){var t=e.mode,n="CHAT"===(void 0===t?"CHAT":t)?r.default:b;return u.a.createElement(l.a,{store:a.a},u.a.createElement(n,null),u.a.createElement(N,null))}},BAMi:function(e,t,n){"use strict";var a=n("s8DI"),r=n("WwEg"),c=n("nfbA"),i=n("mj2O"),o=n.n(i),s=n("7SM1"),u=n("QtlZ"),l=n("ILQF"),d=n("qwiD"),f=n("2XY6"),p=n("K0Zh"),b=n("Maj3"),v=n("ADGC"),h=n("gG69"),g=n("0lfv"),O=n("OA1u"),m=n("LVcX"),j=n("Jstd"),_=n("4Zd6"),k=n("EQxi"),x=function transformNumericConditionValues(e){return"string"===typeof e?Object(g.v)(e):"object"===typeof e&&e.min&&e.max?{min:Object(g.v)(e.min),max:Object(g.v)(e.max)}:e},y=function getSecondsOnPage(e){var t=Object(m.a)(0,["_window","drift_page_view_started"])(e);return(new Date).getTime()/1e3-t},w=function isAnyOf(e,t){return Object(j.a)(function(e){return t===e})(e)},C=function notIsAnyOf(e,t){return!w(e,t)},S=function is(e,t){return e===t},E=function notIs(e,t){return e!==t},I=function lessThan(e,t){return t<e},T=function greaterThan(e,t){return t>e},A=function isBetween(e,t){return!!e.min&&!!e.max&&t>=e.min&&t<=e.max},L=function includesAnyOf(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return Object(j.a)(function(e){return-1!==t.indexOf(e)})(e)},P=function notIncludesAnyOf(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return Object(_.a)(function(e){return-1===t.indexOf(e)})(e)},M={device:{async:!1,selector:function selector(e){return function resolveDeviceType(e){var t=e.toLowerCase();return t.match(/(mobi|phone|ipod|blackberry|docomo|iphone|android)/i)?"mobile":t.match(/(ipad|kindle)/i)?"tablet":"desktop"}(Object(m.a)("",["_window","userAgent"])(e))},operands:{isAnyOf:w,notIsAnyOf:C}},daysSinceLastVisit:{async:!1,selector:function selector(e){return Object(m.a)(0,["visitInformation","daysSinceLastVisit"])(e)},transformValueFn:function transformValueFn(e){return x(e)},operands:{is:S,notIs:E,lessThan:I,greaterThan:T,isBetween:A}},referrer:{async:!1,transformValueFn:function transformValueFn(e){return e.map(function(e){return Object(k.c)(e)})},selector:function selector(e){return Object(k.c)(Object(m.a)("",["referrer"])(e))},operands:{is:S,notIs:E,isAnyOf:w,notIsAnyOf:C,includesAnyOf:L,notIncludesAnyOf:P}},cookie:{async:!1,selector:function selector(e){return Object.entries(Object(m.a)({},["cookies"])(e)).map(function(e){return e.join("=")})},operands:{is:L,notIs:P,isAnyOf:L,notIsAnyOf:P,includesAnyOf:L,notIncludesAnyOf:P}},scrollPct:{async:!0,eventType:"scroll",transformValueFn:function transformValueFn(e){return x(e)},selector:function selector(e){var t=Object(m.a)(0,["_window","scrollY"])(e);return(Object(m.a)(0,["_window","innerHeight"])(e)+t)/Object(m.a)(0,["scrollableHeight"])(e)*100},operands:{lessThan:I,greaterThan:T,isBetween:A}},secondsOnPage:{async:!0,timer:!0,eventType:"timer",selector:function selector(e){return y(e)},transformValueFn:function transformValueFn(e){return x(e)},operands:{lessThan:I,greaterThan:T,isBetween:A}},secondsOnSite:{async:!0,timer:!0,eventType:"timer",transformValueFn:function transformValueFn(e){return x(e)},selector:function selector(e){var t=Object(m.a)(0,["_window","drift_session_started"])(e);return(new Date).getTime()/1e3-t},operands:{lessThan:I,greaterThan:T,isBetween:A}},exitIntent:{async:!0,eventType:"mouseleave",eventProperties:["clientY"],selector:function selector(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(Object(m.a)(!1,["hasExitIntent"])(e))return!0;var t=Object(m.a)(0,["_window","innerHeight"])(e),n=Object(m.a)(t,["eventContext","clientY"])(e),a=y(e);return n/t<.5&&a>5},operands:{is:S,notIs:E}},autoAssigneeId:{async:!1,selector:function selector(e){return Object(m.a)("",["autoAssigneeId"])(e)},operands:{is:S,notIs:E,isAnyOf:w,notIsAnyOf:C}},inboxId:{async:!1,selector:function selector(e){return Object(m.a)("",["embed","configuration","inboxId"])(e)},operands:{isAnyOf:w,notIsAnyOf:C}}},R=function isUnsupportedConditionOrOperator(e){return!M[e.field]||!M[e.field].operands[e.operator]},D=function(){var e=Object(s.a)(o.a.mark(function _callee(e,t){var n,a,r,c,i,s;return o.a.wrap(function _callee$(o){for(;;)switch(o.prev=o.next){case 0:if(!R(e)){o.next=2;break}return o.abrupt("return",Promise.resolve({conditionEvaluation:!0,conditionEvalDetail:{evaluatedCondition:e,matched:!0,status:"EVALUATED"}}));case 2:return n=M[e.field],a=n.operands[e.operator],r=n.transformValueFn?n.transformValueFn(e.value):e.value,o.next=7,n.selector(t,e);case 7:return c=o.sent,i=a(r,c),s={evaluatedCondition:e,matched:i,actualValue:c,status:n.async?i?"EVALUATED":"PENDING":"EVALUATED"},o.abrupt("return",Promise.resolve({conditionEvaluation:i,conditionEvalDetail:s}));case 11:case"end":return o.stop()}},_callee)}));return function evaluateSingleCondition(t,n){return e.apply(this,arguments)}}(),V=function conditionEvaluator(e){return function(t){return D(e,t)}},N=function(){var e=Object(s.a)(o.a.mark(function _callee3(e){var t,n,a,r,c,i,u,l,d,f,p,b,v,h,g;return o.a.wrap(function _callee3$(O){for(;;)switch(O.prev=O.next){case 0:t=e.context,n=e.conditions,a=!1,r=[],c=[],i=function(){var e=Object(s.a)(o.a.mark(function _callee2(e){var n,a,c,i,s,u,l,d,f,p,b,v,h,g,O,m,j;return o.a.wrap(function _callee2$(_){for(;;)switch(_.prev=_.next){case 0:n=!0,a=[],_.t0=o.a.keys(e);case 3:if((_.t1=_.t0()).done){_.next=23;break}return c=_.t1.value,i=e[c],_.next=8,D(i,t);case 8:if(s=_.sent,u=s.conditionEvalDetail,l=s.conditionEvaluation,a.push(u),l||R(u.evaluatedCondition)){_.next=21;break}if(d=M[i.field],f=d.async,p=void 0!==f&&f,b=d.eventType,v=void 0===b?null:b,h=d.timer,g=void 0!==h&&h,O=d.selector,m=d.eventProperties,j=void 0===m?[]:m,n=!1,!p){_.next=19;break}r.push({conditionDefinition:i,selector:O,eventType:v,timer:g,eventProperties:j,type:i.field,evaluator:V(i)}),_.next=21;break;case 19:return r=[],_.abrupt("break",23);case 21:_.next=3;break;case 23:return _.abrupt("return",Promise.resolve({fullGroupMatch:n,groupEval:{targetingConditions:a,status:r.length?"PENDING":"EVALUATED"}}));case 24:case"end":return _.stop()}},_callee2)}));return function evaluateConditions(t){return e.apply(this,arguments)}}(),u=!0,l=!1,d=void 0,O.prev=8,f=n[Symbol.iterator]();case 10:if(u=(p=f.next()).done){O.next=25;break}return b=p.value,O.next=14,i(b);case 14:if(v=O.sent,h=v.fullGroupMatch,g=v.groupEval,c.push(g),!h){O.next=22;break}return a=!0,r=[],O.abrupt("break",25);case 22:u=!0,O.next=10;break;case 25:O.next=31;break;case 27:O.prev=27,O.t0=O.catch(8),l=!0,d=O.t0;case 31:O.prev=31,O.prev=32,u||null==f.return||f.return();case 34:if(O.prev=34,!l){O.next=37;break}throw d;case 37:return O.finish(34);case 38:return O.finish(31);case 39:return O.abrupt("return",Promise.resolve({matched:a,asyncConditionListeners:r,evalLog:c}));case 40:case"end":return O.stop()}},_callee3,null,[[8,27,31,39],[32,,34,38]])}));return function evaluateTargetingConditions(t){return e.apply(this,arguments)}}(),F=n("IpSJ"),H=n("SHZQ"),$=n("Wjfv"),U=n("weY7"),Q=n("FAmh"),G=function AddEvaluationResultToAuditLog(e){var t=e.auditLog,n=e.isServerGenerated,a=void 0===n||n,r=e.evaluationResults,c=e.didMatch,i=e.campaignId,o=e.playbookId,s=e.priority,u=e.status,l=void 0===u?h.b.EVALUATED:u;if(t.conditionGroups){var d=a?Z(r):r;t.conditionGroups.push({status:l,matched:c,conditionSets:d,key:i,playbookId:o,priority:s})}},Z=function _generateAuditLogForServerEvaluationResults(e){return Object(U.a)(function(e){return W(e)},e)},W=function _generateAuditLogResultForConditionSet(e){var t=Object(U.a)(function(e){var t=Object(m.a)(null,["evaluatedTargetCondition","condition"],e),n=Object(m.a)(!1,["evaluatedTargetCondition","matched"],e),a=Object(m.a)(null,["evaluatedTargetCondition","actualValue"],e),r=Object(m.a)({},["evaluatedTargetCondition","evaluationContext"],e);return{evaluatedCondition:t,matched:n,actualValue:a,status:h.b.EVALUATED,evaluationContext:r,meta:{}}},e.evaluatedTargetConditionSet);return{status:h.b.EVALUATED,targetingConditions:t}},Y=function(){var e=Object(s.a)(o.a.mark(function _callee(e){var t,n,a,r=arguments;return o.a.wrap(function _callee$(i){for(;;)switch(i.prev=i.next){case 0:if(t=r.length>1&&void 0!==r[1]&&r[1],e&&e.conditionGroups.length&&!t){i.next=3;break}return i.abrupt("return");case 3:return i.prev=3,i.next=6,Object(H.e)(Object(c.a)(Object(c.a)({},e),Object(Q.c)()));case 6:n=i.sent,a=n.data,u.a.dispatch(Object($.d)({campaignEvalId:a.targetingEvaluationUUID})),i.next=14;break;case 11:i.prev=11,i.t0=i.catch(3),Object(g.x)(["Failed to persist targeting audit log",i.t0]);case 14:case"end":return i.stop()}},_callee,null,[[3,11]])}));return function SaveAuditLog(t){return e.apply(this,arguments)}}();n.d(t,"b",function(){return X}),n.d(t,"c",function(){return K}),n.d(t,"a",function(){return z});var q=["secondsOnSite","secondsOnPage","scrollPct","exitIntent"],B=function(){var e=Object(s.a)(o.a.mark(function _callee(e){var t,n,a,r;return o.a.wrap(function _callee$(c){for(;;)switch(c.prev=c.next){case 0:return t=e.filter(function(e){return!e.allConditionsFullyEvaluated&&e.allConditionsPotentiallyMatched}),n=t.map(function(e){return e.evaluatedTargetConditionSet}),a=n.map(function(e){return e.map(function(e){return e.evaluatedTargetCondition}).map(function(e){return e.condition})}),c.next=5,Object(F.b)();case 5:return r=c.sent,c.next=8,N({conditions:a,context:r});case 8:return c.abrupt("return",c.sent);case 9:case"end":return c.stop()}},_callee)}));return function _evaluateTargetingForEvaluationResults(t){return e.apply(this,arguments)}}(),J=function(){var e=Object(s.a)(o.a.mark(function _callee3(e){var t,n,a,r,i,d,f=arguments;return o.a.wrap(function _callee3$(p){for(;;)switch(p.prev=p.next){case 0:if(t=f.length>1&&void 0!==f[1]?f[1]:function(){},n=Object(g.w)(),a=function(){var a=Object(s.a)(o.a.mark(function _callee2(){var a,r,i=arguments;return o.a.wrap(function _callee2$(o){for(;;)switch(o.prev=o.next){case 0:return a=i.length>0&&void 0!==i[0]?i[0]:{},o.next=3,Object(F.b)();case 3:return r=o.sent,o.next=6,e.evaluator(Object(c.a)(Object(c.a)({},r),{},{eventContext:a}));case 6:if(o.sent.conditionEvaluation){o.next=9;break}return o.abrupt("return");case 9:e.eventType&&("exitIntent"===e.type&&u.a.dispatch(Object(O.b)()),Object(l.a)({topic:"remove-host-event-listener",message:{id:n,event:e.eventType}}),t());case 10:case"end":return o.stop()}},_callee2)}));return function asyncConditionHandler(){return a.apply(this,arguments)}}(),!e.timer){p.next=12;break}return p.next=6,Object(F.b)();case 6:r=p.sent,i=e.conditionDefinition.value,(d=i-e.selector(r))>0&&setTimeout(a,1e3*d+1e3),p.next=13;break;case 12:Object(l.a)({topic:"add-host-event-listener",message:{id:n,event:e.eventType,handler:a,eventProperties:e.eventProperties||[]}});case 13:case"end":return p.stop()}},_callee3)}));return function _waitForCondition(t){return e.apply(this,arguments)}}(),X=function(){var e=Object(s.a)(o.a.mark(function _callee4(e){var t,n,a,i,s,u,l,d,f,b,v,g,O,m,j;return o.a.wrap(function _callee4$(o){for(;;)switch(o.prev=o.next){case 0:if(e&&e.length){o.next=2;break}return o.abrupt("return",null);case 2:t=Object(c.a)({conditionGroups:[]},Object(Q.c)()),n=!0,a=!1,i=void 0,o.prev=6,s=e[Symbol.iterator]();case 8:if(n=(u=s.next()).done){o.next=32;break}if((l=u.value).status!==h.b.EVALUATED||!l.matched){o.next=14;break}t.conditionGroups.push(l),o.next=29;break;case 14:if(l.status!==h.b.PENDING){o.next=29;break}return d=l.conditionSets.filter(function(e){return e.status===h.b.PENDING}).map(function(e){return e.targetingConditions}),f=d.map(function(e){return e.filter(function(e){return e.status===h.b.PENDING}).map(function(e){return e.evaluatedCondition})}),b=d.map(function(e){return e.filter(function(e){return e.status===h.b.EVALUATED})}),v=Object(p.a)(b),o.next=21,Object(F.b)();case 21:return g=o.sent,o.next=24,N({conditions:f,context:g});case 24:O=o.sent,m=O.matched,j=O.evalLog,v.length&&(j[0].targetingConditions=[].concat(Object(r.a)(j[0].targetingConditions),Object(r.a)(v))),t.conditionGroups.push({status:h.b.EVALUATED,matched:m,conditionSets:j,key:l.key,priority:l.priority});case 29:n=!0,o.next=8;break;case 32:o.next=38;break;case 34:o.prev=34,o.t0=o.catch(6),a=!0,i=o.t0;case 38:o.prev=38,o.prev=39,n||null==s.return||s.return();case 41:if(o.prev=41,!a){o.next=44;break}throw i;case 44:return o.finish(41);case 45:return o.finish(38);case 46:return o.abrupt("return",t);case 47:case"end":return o.stop()}},_callee4,null,[[6,34,38,46],[39,,41,45]])}));return function evaluateConditionalSkillTargetingConditions(t){return e.apply(this,arguments)}}(),K=function(){var e=Object(s.a)(o.a.mark(function _callee5(e){var t,n,a,c,i,s,u,l,d,f,p;return o.a.wrap(function _callee5$(o){for(;;)switch(o.prev=o.next){case 0:if(t=e.evaluationMatchOutcome,n=e.evaluationResults,a=void 0===n?[]:n,c=e.onMatched,i=void 0===c?function(){}:c,s=e.onDidNotMatch,u=void 0===s?function(){}:s,l=[],t!==h.a.MATCH){o.next=4;break}return o.abrupt("return",i());case 4:if(t!==h.a.NO_MATCH){o.next=6;break}return o.abrupt("return",u());case 6:if(t!==h.a.POTENTIAL_MATCH){o.next=17;break}return o.next=9,B(a);case 9:if(d=o.sent,f=d.matched,p=d.asyncConditionListeners,!f){o.next=16;break}return o.abrupt("return",i());case 16:l=[].concat(Object(r.a)(l),Object(r.a)(p));case 17:if(l.forEach(function(e){return J(e,function(){return i()})}),l.length){o.next=20;break}return o.abrupt("return",u());case 20:return o.abrupt("return",u());case 21:case"end":return o.stop()}},_callee5)}));return function evaluateWidgetDisplayTargetingConditions(t){return e.apply(this,arguments)}}(),z=function(){var e=Object(s.a)(o.a.mark(function _callee8(e){var t,n,c,i,l,p,g,O,m,j,_,k,x,y,w,C,S,E,I,T,A,L,P,M,R,D,V,N,F,H,$,U,Q,Z,W;return o.a.wrap(function _callee8$(X){for(;;)switch(X.prev=X.next){case 0:w=function _ref16(e){return Object(b.a)(function(e){return e.evaluatedTargetConditionSet},e.filter(function(e){return e.fullyEvaluatedAndMatched})).filter(function(e){return e.fullyEvaluated}).map(function(e){return e.evaluatedTargetCondition}).filter(function(e){return e.matched}).map(function(e){return e.condition})},y=function _ref15(e){var t=e.filter(function(e){return"EVALUATED"===e.status}).map(function(e){return e.targetingConditions}).filter(function(e){return e.filter(function(e){return e.matched})});return Object(b.a)(function(e){return e.map(function(e){return e.evaluatedCondition})},t)},t=e.conditions,n=void 0===t?[]:t,c=e.onMatched,i=void 0===c?function(){}:c,l=e.onDidNotMatch,p=void 0===l?function(){}:l,g=e.internal,O=void 0!==g&&g,m={conditionGroups:[]},j=[],_=function debugLogIconVisibility(){var e,t=Object(u.b)(),n=t.view,a=void 0===n?{}:n,r=t.conversations,c=void 0===r?{}:r,i=t.campaigns,o=void 0===i?{}:i,s=!Object(v.c)();if(Object(f.g)(t))if(c.hasForcedConversation&&s)u.a.dispatch(Object(d.k)({debugLog:"Drift icon will show, found a forced conversation on desktop",order:4}));else if(null===(e=o.activeCampaign)||void 0===e?void 0:e.id){var l;u.a.dispatch(Object(d.k)({debugLog:"Drift icon will show, found an active campaign ".concat(null===o||void 0===o?void 0:null===(l=o.activeCampaign)||void 0===l?void 0:l.id),order:4}))}else c.activeConversation?u.a.dispatch(Object(d.k)({debugLog:"Drift icon will show, found an active conversation ".concat(c.activeConversation),order:4})):a.matchedTargeting&&u.a.dispatch(Object(d.k)({debugLog:"Drift icon will show, found a targeting match",order:4}));else u.a.dispatch(Object(d.k)({debugLog:"Hiding Drift icon",order:4}))},k=function(){var e=Object(s.a)(o.a.mark(function _callee6(e){var t,n,a;return o.a.wrap(function _callee6$(r){for(;;)switch(r.prev=r.next){case 0:return t=e.campaignId,n=e.matchedConditions,a=(void 0===n?[]:n).map(function(e){return e.field}).filter(function(e){return q.includes(e)}).length>0,r.next=4,Y(m,O);case 4:if(r.t0=i,!r.t0){r.next=8;break}return r.next=8,i(t,a);case 8:return _(),r.abrupt("return",Promise.resolve({TAL:m,matched:!0}));case 10:case"end":return r.stop()}},_callee6)}));return function onConditionMatched(t){return e.apply(this,arguments)}}(),x=function(){var e=Object(s.a)(o.a.mark(function _callee7(){return o.a.wrap(function _callee7$(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Y(m);case 2:return p&&p(),u.a.dispatch(Object(d.k)({debugLog:"No playbooks matched",order:3})),_(),e.abrupt("return",Promise.resolve({TAL:m,matched:!1}));case 6:case"end":return e.stop()}},_callee7)}));return function onNoConditionMatched(){return e.apply(this,arguments)}}(),C=!0,S=!1,E=void 0,X.prev=11,I=n.entries()[Symbol.iterator]();case 13:if(C=(T=I.next()).done){X.next=48;break}if(A=Object(a.a)(T.value,2),L=A[0],P=A[1],M=P.campaignId,R=P.evaluationMatchOutcome,D=P.evaluationResults,V=void 0===D?[]:D,N=P.playbookId,R!==h.a.NO_MATCH){X.next=20;break}G({evaluationResults:V,auditLog:m,didMatch:!1,campaignId:M,playbookId:N,priority:L+1}),X.next=41;break;case 20:if(R!==h.a.MATCH){X.next=26;break}return G({evaluationResults:V,auditLog:m,didMatch:!0,campaignId:M,playbookId:N,priority:L+1}),F=w(V),X.abrupt("return",k({campaignId:M,matchedConditions:F}));case 26:if(R!==h.a.POTENTIAL_MATCH){X.next=41;break}return X.next=29,B(V);case 29:if(H=X.sent,$=H.matched,U=H.asyncConditionListeners,Q=H.evalLog,G({auditLog:m,evaluationResults:Z=void 0===Q?[]:Q,didMatch:$,campaignId:M,priority:L+1,isServerGenerated:!1,status:U.length?h.b.PENDING:h.b.EVALUATED}),!$){X.next=40;break}return W=y(Z),X.abrupt("return",k({campaignId:M,matchedConditions:W}));case 40:j=[].concat(Object(r.a)(j),Object(r.a)(U));case 41:if(L!==n.length-1){X.next=45;break}if(j.forEach(function(e){return J(e,function(){return z({conditions:n,onMatched:i,onDidNotMatch:p})})}),j.length){X.next=45;break}return X.abrupt("return",x());case 45:C=!0,X.next=13;break;case 48:X.next=54;break;case 50:X.prev=50,X.t0=X.catch(11),S=!0,E=X.t0;case 54:X.prev=54,X.prev=55,C||null==I.return||I.return();case 57:if(X.prev=57,!S){X.next=60;break}throw E;case 60:return X.finish(57);case 61:return X.finish(54);case 62:return X.abrupt("return",x());case 63:case"end":return X.stop()}},_callee8,null,[[11,50,54,62],[55,,57,61]])}));return function evaluateCampaignTargetingConditions(t){return e.apply(this,arguments)}}()},FAmh:function(e,t,n){"use strict";n.d(t,"a",function(){return w}),n.d(t,"c",function(){return C}),n.d(t,"b",function(){return S});var a=n("nfbA"),r=n("mj2O"),c=n.n(r),i=n("7SM1"),o=n("SHZQ"),s=n("QtlZ"),u=n("vjCh"),l=n("La++"),d=n("B8JY"),f=n("Hvhg"),p=n("SFoa"),b=n("qwiD"),v=n("+f1A"),h=n("BAMi"),g=n("awwx"),O=n("g6eD"),m=n("2XY6"),j=n("i9gz"),_=n("LVcX"),k=n("0lfv"),x=n("ws1h"),y=function(){var e=Object(i.a)(c.a.mark(function _callee(e){var t,n,a,r,i,o,u;return c.a.wrap(function _callee$(c){for(;;)switch(c.prev=c.next){case 0:return t=e.forceShow,n=void 0!==t&&t,a=e.targetingResults,r=void 0===a?{}:a,i=Object(g.c)(Object(s.b)()),o=function dispatchWidgetTargetingResult(e,t){s.a.dispatch(Object(O.o)({matchedTargeting:t,matchedHours:e}))},c.next=5,Object(x.a)();case 5:if(u=c.sent,!i){c.next=9;break}return o(u,!1),c.abrupt("return");case 9:n?o(!0,!0):Object(h.c)({evaluationMatchOutcome:r.evaluationMatchOutcome,evaluationResults:r.evaluationResults,onMatched:function onMatched(){o(u,!0)},onDidNotMatch:function onDidNotMatch(){return o(u,!1)}});case 10:case"end":return c.stop()}},_callee)}));return function evaluateWidgetTargeting(t){return e.apply(this,arguments)}}(),w=function(){var e=Object(i.a)(c.a.mark(function _callee4(){var e,t,n,r,v,O,_,x,w,C,E,I,T,A,L,P,M,R,D,V=arguments;return c.a.wrap(function _callee4$(N){for(;;)switch(N.prev=N.next){case 0:if(e=V.length>0&&void 0!==V[0]?V[0]:{},t=e.onDidNotMatch,n=void 0===t?function(){}:t,r=e.onDidMatch,v=void 0===r?function(){}:r,O=e.unreadCampaignIds,_=void 0===O?[]:O,x=e.evaluatedConditionsResults,w=e.skipCampaignTargeting,C=void 0!==w&&w,E=Object(s.b)(),I=Object(g.a)(["skipCampaigns"],E),T=!!Object(g.a)(["forceShowWidget"],E),A=Object(f.e)(E),L=C||I,P=function(){var e=Object(i.a)(c.a.mark(function _callee3(e){var t;return c.a.wrap(function _callee3$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,y({forceShow:T,targetingResults:e.widgetTargetingResults});case 2:if(!L){a.next=4;break}return a.abrupt("return");case 4:return s.a.dispatch(Object(b.k)({debugLog:"Checking playbooks targeting (use 'drift.debug('playbooks')' for more detail)",order:2})),t=function(){var e=Object(i.a)(c.a.mark(function _callee2(e,t){var n,a,r;return c.a.wrap(function _callee2$(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,v();case 2:if(!Object(m.c)(Object(s.b)())){c.next=4;break}return c.abrupt("return");case 4:if(!_.includes(e)){c.next=7;break}return c.abrupt("return",Object(u.j)(e));case 7:if(n=Object(p.b)(e),!("BOT"!==(null===n||void 0===n?void 0:n.type))){c.next=15;break}return s.a.dispatch(Object(b.k)({debugLog:"Rendered announcement campaign ".concat(e),order:3})),c.next=13,Object(l.b)(e,t);case 13:c.next=19;break;case 15:return r=null===n||void 0===n?void 0:null===(a=n.attributes)||void 0===a?void 0:a.playbookId,s.a.dispatch(Object(b.k)({debugLog:"Rendered bot playbook ".concat(r," from campaign ").concat(e),order:3})),c.next=19,Object(l.c)({campaignId:e,isDelayed:t,playbookId:r});case 19:case"end":return c.stop()}},_callee2)}));return function onCampaignMatch(t,n){return e.apply(this,arguments)}}(),a.next=8,Object(h.a)({conditions:e.campaignTargetingResults,onMatched:t,onDidNotMatch:n});case 8:case"end":return a.stop()}},_callee3)}));return function evaluateTargetingConditions(t){return e.apply(this,arguments)}}(),N.prev=8,x&&!Object(j.a)(x)){N.next=24;break}return M=S(),N.next=13,Object(o.d)(Object(a.a)(Object(a.a)({embedId:A},M),{},{followingCampaignIds:_,excludedCampaignIds:[]}));case 13:if(R=N.sent,D=R.data){N.next=18;break}return Object(k.n)({data:["Empty payload returned for campaign targeting"],type:"warn"}),N.abrupt("return");case 18:return Object(k.m)(D.relevantCampaigns)||s.a.dispatch(Object(d.c)({campaigns:D.relevantCampaigns})),Object(k.m)(D.relevantUsers)||s.a.dispatch(Object(d.e)({relevantUsers:D.relevantUsers})),N.next=22,P(D);case 22:N.next=26;break;case 24:return N.next=26,P(x);case 26:N.next=31;break;case 28:N.prev=28,N.t0=N.catch(8),Object(k.f)(new Error("Failed to evaluate campaign targeting - ".concat(N.t0.message)),N.t0);case 31:case"end":return N.stop()}},_callee4,null,[[8,28]])}));return function evalTargetingAndEnrollment(){return e.apply(this,arguments)}}(),C=function getTargetingEvaluationMetadata(){var e=Object(s.b)();return{targetingContext:{endUserId:Object(_.a)(void 0,["endUser","id"],e.session),orgId:Object(p.h)()},evaluationOptions:{ignoreUnknowns:!1}}},S=function getTargetingEvaluationContext(){var e=Object(s.b)(),t=e.session,n=e.conversations,a=e.embed,r=t.campaignRefreshToken,c=t.geo,i=t.context,o=t.assignedAgentId,u=Object(j.a)(c)?void 0:c,l=Object(_.a)("",["page","href"],i),d=Object(_.a)({},["conversations"],n);return{sessionId:r,location:u,pageUrl:l,assignedAgentId:o,hasHadConversations:!Object(j.a)(d),inboxId:Object(_.a)(void 0,["configuration","inboxId"],a),siteVisits:Object(v.u)(e)}}},HPUV:function(e,t,n){"use strict";n.d(t,"a",function(){return o});var a=n("mj2O"),r=n.n(a),c=n("7SM1"),i=n("ILQF"),o=function(){var e=Object(c.a)(r.a.mark(function _callee(){return r.a.wrap(function _callee$(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(i.a)({topic:"kill-announcement-frames",message:{}});case 2:case"end":return e.stop()}},_callee)}));return function requestKillAnnouncementFrames(){return e.apply(this,arguments)}}()},IpSJ:function(e,t,n){"use strict";n.d(t,"b",function(){return O}),n.d(t,"a",function(){return m}),n.d(t,"c",function(){return j});var a=n("mj2O"),r=n.n(a),c=n("7SM1"),i=n("SHZQ"),o=n("QtlZ"),s=n("ILQF"),u=n("Hvhg"),l=n("mfas"),d=n("LVcX"),f=n("0lfv"),p=n("0LtH"),b=n("BAMi"),v=n("awwx"),h=n("FAmh"),g=function omitPropertyFromConditionSetList(e,t){return e.map(function(e){return e.map(function(e){return Object(l.a)([t],e)})})},O=function(){var e=Object(c.a)(r.a.mark(function _callee(){var e,t,n,a,c,i,u,l,d,f,p,b,h,g,O,m,j,_;return r.a.wrap(function _callee$(r){for(;;)switch(r.prev=r.next){case 0:return e=Object(o.b)(),t=e.embed,n=e.session,a=e.targeting,c=void 0===a?{}:a,i=Object(v.b)(e),r.next=5,Object(s.a)({topic:"get-window-context"});case 5:return u=r.sent,l=u.data,d=void 0===l?{}:l,r.next=10,Object(s.a)({topic:"get-host-cookies"});case 10:return f=r.sent,p=f.data,b=void 0===p?{}:p,r.next=15,Object(s.a)({topic:"get-host-referrer"});case 15:return h=r.sent,g=h.data,O=void 0===g?"":g,r.next=20,Object(s.a)({topic:"get-scrollable-height"});case 20:return m=r.sent,j=m.data,_={_window:d,visitInformation:n.visitInformation,cookies:b,geo:n.geo,embed:t,referrer:O,autoAssigneeId:i,scrollableHeight:j,hasExitIntent:c.hasExitIntent},r.abrupt("return",Promise.resolve(_));case 24:case"end":return r.stop()}},_callee)}));return function generateTargetingContext(){return e.apply(this,arguments)}}(),m=function(){var e=Object(c.a)(r.a.mark(function _callee2(){var e,t,n,a,c,s,l=arguments;return r.a.wrap(function _callee2$(r){for(;;)switch(r.prev=r.next){case 0:return e=l.length>0&&void 0!==l[0]?l[0]:[],t=e.map(function(e){var t=g(e.conditionSets,"mapValue");return{key:"".concat(e.outputKey,"-").concat(e.label),priority:e.priority,conditionSets:t}}),n=Object(u.e)(Object(o.b)()),a=Object(h.b)(),r.prev=4,r.next=7,Object(i.b)(n,{clientSideContext:a,conditionGroups:t});case 7:return c=r.sent,s=c.data,r.next=11,Object(b.b)(s);case 11:return r.abrupt("return",r.sent);case 14:r.prev=14,r.t0=r.catch(4),Object(f.n)({data:["Failed to evaluate conditional skill",r.t0]});case 17:case"end":return r.stop()}},_callee2,null,[[4,14]])}));return function evaluateTargetingForConditionalSets(){return e.apply(this,arguments)}}(),j=function(){var e=Object(c.a)(r.a.mark(function _callee3(){var e,t,n,a,c;return r.a.wrap(function _callee3$(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,Object(s.a)({topic:"get-window-context"});case 2:return e=r.sent,t=e.data,n=void 0===t?{}:t,a=Object(d.a)("",["location","hash"],n),r.next=8,Object(p.a)(a);case 8:return c=r.sent,r.abrupt("return",c);case 10:case"end":return r.stop()}},_callee3)}));return function tryFireDriftLink(){return e.apply(this,arguments)}}()},a4Je:function(e,t,n){"use strict";n.d(t,"a",function(){return g}),n.d(t,"c",function(){return O}),n.d(t,"b",function(){return m});var a=n("mj2O"),r=n.n(a),c=n("7SM1"),i=n("LqZ+"),o=n("QtlZ"),s=n("9EWH"),u=n("ILQF"),l=n("fsHk"),d=n("LVcX"),f=n("iJtH"),p=n("YvIt"),b=n("Nlet"),v=n("t8ds"),h=n("qwiD"),g=function(){var e=Object(c.a)(r.a.mark(function _callee(){var e,t,n,a,c,i,d,b,g,O;return r.a.wrap(function _callee$(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,Object(u.a)({topic:"access-host-window",message:{key:"location"}});case 2:return e=r.sent,t=e.data,n=void 0===t?{}:t,r.next=7,v.a.get(f.a);case 7:return a=r.sent,c=a.data,r.next=11,v.b.get(p.b);case 11:i=r.sent,d=i.data,b=c||{},g=function getSessionCount(e){return e.lastSessionId?e.lastSessionId!==d?e.total+1:e.total:1},O=Object(s.a)(b,function(e){var t=l.a.getCurrentTimeEpoch();e.total=g(e),e.daysSinceLastVisit=l.a.getCurrentTimeDifferenceInDays(e.lastVisit),e.lastVisit=t,e.firstVisit=e.firstVisit||t,e.lastSessionId=d,e[n.pathname]=(e[n.pathname]||0)+1;var a=l.a.getTime(b.lastVisit,l.a.getTimezone()).diff(t,"minute");(!b.currentSessionStartedAt||a>30)&&(e.currentSessionStartedAt=t,v.a.removeItem(p.a))}),v.a.set(f.a,O),o.a.dispatch(Object(h.w)(O));case 18:case"end":return r.stop()}},_callee)}));return function countSiteVisit(){return e.apply(this,arguments)}}(),O=function(){var e=Object(c.a)(r.a.mark(function _callee2(e){var t,n;return r.a.wrap(function _callee2$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,m();case 2:t=a.sent,n={url:Object(d.a)("",["page","href"],t),referrer:Object(d.a)("",["page","referrer"],t),title:Object(d.a)("",["page","title"],t),pageName:e||""},Object(i.b)(n);case 5:case"end":return a.stop()}},_callee2)}));return function trackPageLoadEvent(t){return e.apply(this,arguments)}}(),m=function(){var e=Object(c.a)(r.a.mark(function _callee3(){var e;return r.a.wrap(function _callee3$(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(b.a)();case 2:return e=t.sent,o.a.dispatch(Object(h.i)(e)),t.abrupt("return",e);case 5:case"end":return t.stop()}},_callee3)}));return function hydrateWindowContext(){return e.apply(this,arguments)}}()},"dVh+":function(e,t,n){"use strict";n.d(t,"a",function(){return s});var a=n("mj2O"),r=n.n(a),c=n("7SM1"),i=n("uIJS"),o=n("wQh9"),s=function(){function SyncCallbackRunner(){Object(i.a)(this,SyncCallbackRunner),this._running=!1,this._callbacks=[]}return Object(o.a)(SyncCallbackRunner,[{key:"execute",value:function execute(e){this._callbacks.push(e),this.run()}},{key:"run",value:function(){var e=Object(c.a)(r.a.mark(function _callee(){var e,t;return r.a.wrap(function _callee$(n){for(;;)switch(n.prev=n.next){case 0:if(!this._running&&0!==this._callbacks.length){n.next=2;break}return n.abrupt("return");case 2:this._running=!0;case 3:if(!(this._callbacks.length>0)){n.next=11;break}if(e=this._callbacks.shift(),!(t=e())||!t.then){n.next=9;break}return n.next=9,t;case 9:n.next=3;break;case 11:this._running=!1;case 12:case"end":return n.stop()}},_callee,this)}));return function run(){return e.apply(this,arguments)}}()}]),SyncCallbackRunner}()},"hC/6":function(e,t,n){"use strict";n.d(t,"b",function(){return r}),n.d(t,"a",function(){return c});var a=n("Cpup"),r=function receiveSentryConfig(e){return Object(a.a)({type:"RECEIVE_SENTRY_CONFIG",payload:e})},c=function receiveLongPollConfig(e){return Object(a.a)({type:"RECEIVE_LONG_POLL_CONFIG",payload:e})}},kVVm:function(e,t,n){"use strict";var a=n("mj2O"),r=n.n(a),c=n("7SM1"),i=n("yKvL"),o=n("0lfv"),s=n("uIJS"),u=n("wQh9"),l=n("LvsC"),d=n("qytN"),f=n("7jL2"),p=n("QtlZ"),b=n("mfas"),v=n("LVcX"),h=n("hm8b"),g=function(){var e=Object(c.a)(r.a.mark(function _callee(){var e,t,n,a;return r.a.wrap(function _callee$(r){for(;;)switch(r.prev=r.next){case 0:return e=Object(p.b)(),t=e.session,n=e.conversations,a=Object(b.a)(["href"],t.context.page),r.abrupt("return",{engagement:{activeConversation:n.endUserEngaged},page:a,location:m(t.geo),session:O(t.context,t.visitInformation)});case 3:case"end":return r.stop()}},_callee)}));return function generatePresenceContext(){return e.apply(this,arguments)}}(),O=function _hydrateSessionPresenceData(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return{numPageViews:Object(v.a)(0,["total"],t),numSessions:Object(v.a)(0,["total"],t),currentSessionStartedAt:e.currentSessionStartedAt,currentPageViewStartedAt:e.currentPageViewStartedAt,previousSessionStartedAt:Object(v.a)(null,["lastVisit"],t),previousSessionEndedAt:null,firstSessionAt:Object(v.a)(null,["firstVisit"],t),activeSessionStartedAt:e.activeSessionStartedAt}},m=function _hydrateGeoPresenceData(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(h.a)(e)?{}:{ip:e.ip,city:e.city,subdivision:e.subdivision,country:e.country,countryCode:e.countryCode,gdprApplicable:e.gdprApplicable,metroCode:e.metroCode,postalCode:e.postalCode,latLong:{lat:e.latitude,lon:e.longitude}}},j=n("7VeV"),_=n("+D5C"),k=5e3,x=n("nfbA"),y=n("xKh3"),w=n("ZwRX"),C=n("qwiD"),S=n("+f1A"),E=function(){function SocketManager(){var e=this;Object(s.a)(this,SocketManager),this._heartbeatInterval=void 0,this._socket=void 0,this._channel=void 0,this._connectionType=void 0,this._channelEvents=void 0,this._channelName=void 0,this._fireChannelConnectedEvent=function(e,t,n){p.a.dispatch(Object(C.g)(Object(x.a)({key:e,cluster:t},n)))},this._connectToSocket=function(){var e=Object(c.a)(r.a.mark(function _callee2(e){var t,n,a,i,o;return r.a.wrap(function _callee2$(s){for(;;)switch(s.prev=s.next){case 0:return t=e.session_token,n=e.org_id,a=e.socketCluster,i=e.ip,o=new Promise(function(){var e=Object(c.a)(r.a.mark(function _callee(e,c){var o;return r.a.wrap(function _callee$(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,Object(y.b)({session_token:t,org_id:n,socketCluster:a,ip:i});case 2:if(!(o=r.sent)){r.next=7;break}return r.abrupt("return",e(o));case 7:return r.abrupt("return",c(new Error("Could not connect to socket")));case 8:case"end":return r.stop()}},_callee)}));return function(t,n){return e.apply(this,arguments)}}()),s.abrupt("return",o);case 3:case"end":return s.stop()}},_callee2)}));return function(t){return e.apply(this,arguments)}}(),this._connectToChannel=function(){var t=Object(c.a)(r.a.mark(function _callee3(t){var n,a,c,i,s,u;return r.a.wrap(function _callee3$(r){for(;;)switch(r.prev=r.next){case 0:return n=t.socket,a=t.socketAuth,c=t.channelEvents,i=t.channelName,s=t.orgId,r.prev=1,r.next=4,Object(y.a)({channelName:e._resolveChannelName(i,a.user_id,s),socket:n,events:e._resolveChannelEvents(c)});case 4:return u=r.sent,r.abrupt("return",u);case 8:r.prev=8,r.t0=r.catch(1),Object(o.f)(r.t0);case 11:case"end":return r.stop()}},_callee3,null,[[1,8]])}));return function(e){return t.apply(this,arguments)}}(),this._resolveChannelName=function(e,t,n){switch(e){case _.b.USER:case _.b.CHAT:return"".concat(e,":").concat(t);case _.b.LIVE:return"".concat(e,":").concat(n);default:return""}},this._resolveChannelEvents=function(e){switch(e){case _.a.CHAT:return w.a;case _.a.USER:return w.c;case _.a.PRESENCE:return w.b;default:return[]}},this._socket=null,this._channel=null,this._heartbeatInterval=null}return Object(u.a)(SocketManager,[{key:"_fireSocketConnectedEvent",value:function _fireSocketConnectedEvent(e){p.a.dispatch(Object(C.v)({cluster:e}))}}]),Object(u.a)(SocketManager,[{key:"canConnect",value:function canConnect(){return console.error("function should be implemented in child class"),!1}},{key:"getAuthForSocketConnection",value:function(){var e=Object(c.a)(r.a.mark(function _callee4(){return r.a.wrap(function _callee4$(e){for(;;)switch(e.prev=e.next){case 0:console.error("function should be implemented in child class");case 1:case"end":return e.stop()}},_callee4)}));return function getAuthForSocketConnection(){return e.apply(this,arguments)}}()},{key:"postConnect",value:function(){var e=Object(c.a)(r.a.mark(function _callee5(){return r.a.wrap(function _callee5$(e){for(;;)switch(e.prev=e.next){case 0:console.error("function should be implemented in child class");case 1:case"end":return e.stop()}},_callee5)}));return function postConnect(){return e.apply(this,arguments)}}()},{key:"connect",value:function(){var e=Object(c.a)(r.a.mark(function _callee6(e){var t,n,a;return r.a.wrap(function _callee6$(r){for(;;)switch(r.prev=r.next){case 0:if(t=e.orgId,n=e.auth,this.canConnect()){r.next=3;break}return r.abrupt("return",null);case 3:if(r.t0=n,r.t0){r.next=8;break}return r.next=7,Object(S.b)(Object(p.b)(),this._connectionType);case 7:r.t0=r.sent;case 8:if(a=r.t0,!Object(o.m)(a)){r.next=12;break}return Object(o.f)("Failed to connect to ".concat(this._connectionType," socket: no authentication information provided by server")),r.abrupt("return",null);case 12:return r.next=14,this._connectToSocket({ip:a.remote_ip,org_id:t,session_token:a.session_token,socketCluster:this._connectionType});case 14:return this._socket=r.sent,this._fireSocketConnectedEvent(this._connectionType),r.next=18,this._connectToChannel({socket:this._socket,channelEvents:this._channelEvents,channelName:this._channelName,orgId:t,socketAuth:a});case 18:if(this._channel=r.sent,this._fireChannelConnectedEvent("user",this._connectionType,this._channel),!this._channel){r.next=23;break}return this.postConnect(),r.abrupt("return",this._socket);case 23:case"end":return r.stop()}},_callee6,this)}));return function connect(t){return e.apply(this,arguments)}}()}]),SocketManager}();function _createSuper2(e){return function(){var t,n=Object(f.a)(e);if(function isNativeReflectConstruct(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}()){var a=Object(f.a)(this).constructor;t=Reflect.construct(n,arguments,a)}else t=n.apply(this,arguments);return Object(d.a)(this,t)}}var I=new(function(e){Object(l.a)(ChatSocketManager,e);var t=_createSuper2(ChatSocketManager);function ChatSocketManager(){var e;return Object(s.a)(this,ChatSocketManager),(e=t.call(this))._sendPresencePing=Object(c.a)(r.a.mark(function _callee(){var t,n;return r.a.wrap(function _callee$(a){for(;;)switch(a.prev=a.next){case 0:if(e._channel){a.next=2;break}return a.abrupt("return");case 2:return a.next=4,g();case 4:t=a.sent,n=t.page,e._channel.channel.push("presence:send_update",{page:n});case 7:case"end":return a.stop()}},_callee)})),e.throttledPresencePing=Object(j.throttle)(k,!1,e._sendPresencePing),e._connectionType=_.c.CHAT,e._channelEvents=_.a.USER,e._channelName=_.b.USER,e}return Object(u.a)(ChatSocketManager,[{key:"canConnect",value:function canConnect(){return!0}},{key:"postConnect",value:function(){var e=Object(c.a)(r.a.mark(function _callee2(){var e=this;return r.a.wrap(function _callee2$(t){for(;;)switch(t.prev=t.next){case 0:this._sendPresencePing(),this._channel.channel.on("presence:request_update",function(){e.throttledPresencePing()});case 2:case"end":return t.stop()}},_callee2,this)}));return function postConnect(){return e.apply(this,arguments)}}()}]),ChatSocketManager}(E)),T=n("76KI");function visitorPresence_createSuper2(e){return function(){var t,n=Object(f.a)(e);if(function isNativeReflectConstruct(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}()){var a=Object(f.a)(this).constructor;t=Reflect.construct(n,arguments,a)}else t=n.apply(this,arguments);return Object(d.a)(this,t)}}var A=new(function(e){Object(l.a)(VisitorPresenceSocketManager,e);var t=visitorPresence_createSuper2(VisitorPresenceSocketManager);function VisitorPresenceSocketManager(){var e;return Object(s.a)(this,VisitorPresenceSocketManager),(e=t.call(this))._heartbeatInterval=void 0,e._socket=void 0,e._channel=void 0,e._connectionType=_.c.VISITOR_PRESENCE,e._channelEvents=_.a.PRESENCE,e._channelName=_.b.LIVE,e}return Object(u.a)(VisitorPresenceSocketManager,[{key:"canConnect",value:function canConnect(){return!Object(T.a)("has_presence_disabled")}},{key:"postConnect",value:function(){var e=Object(c.a)(r.a.mark(function _callee(){return r.a.wrap(function _callee$(e){for(;;)switch(e.prev=e.next){case 0:this._channel&&(this._updatePresence(),this.startPresenceUpdateHeartbeat());case 1:case"end":return e.stop()}},_callee,this)}));return function postConnect(){return e.apply(this,arguments)}}()},{key:"startPresenceUpdateHeartbeat",value:function startPresenceUpdateHeartbeat(){this._heartbeatInterval=window.setInterval(this._updatePresence.bind(this),6e4)}},{key:"_updatePresence",value:function(){var e=Object(c.a)(r.a.mark(function _callee2(){var e;return r.a.wrap(function _callee2$(t){for(;;)switch(t.prev=t.next){case 0:if(this._channel){t.next=2;break}return t.abrupt("return");case 2:return t.next=4,g();case 4:e=t.sent,this._channel.channel.push("heartbeat",e);case 6:case"end":return t.stop()}},_callee2,this)}));return function _updatePresence(){return e.apply(this,arguments)}}()},{key:"stopPresenceUpdateHeartbeat",value:function stopPresenceUpdateHeartbeat(){window.clearInterval(this._heartbeatInterval)}}]),VisitorPresenceSocketManager}(E));n.d(t,"a",function(){return L});var L=function(){var e=Object(c.a)(r.a.mark(function _callee(e){var t,n;return r.a.wrap(function _callee$(a){for(;;)switch(a.prev=a.next){case 0:return t=e.orgId,n=e.chatAuth,a.prev=1,a.next=4,I.connect({orgId:t,auth:n});case 4:A.connect({orgId:t}),a.next=10;break;case 7:a.prev=7,a.t0=a.catch(1),Object(o.f)(new i.a("Failed to connect to sockets - ".concat(a.t0.message)));case 10:case"end":return a.stop()}},_callee,null,[[1,7]])}));return function connectToWidgetSockets(t){return e.apply(this,arguments)}}()},mJgV:function(e,t,n){"use strict";n.d(t,"a",function(){return r});var a=n("LVcX"),r=function getLongPollEnabledShards(e){return Object(a.a)(void 0,["logging","longPollConfig","enabledShards"],e)}},"q+IY":function(e,t,n){"use strict";n.d(t,"a",function(){return m});var a=n("mj2O"),r=n.n(a),c=n("7SM1"),i=n("SHZQ"),o=n("QtlZ"),s=n("Hvhg"),u=n("BAMi"),l=n("FAmh"),d=n("4Vr+"),f=n("yzXs"),p=n("42TE"),b=n("gG69"),v=n("0lfv"),h=n("76KI"),g=n("4c+F"),O=Object(d.a)(Object(f.a)(p.a,v.m)),m=function(){var e=Object(c.a)(r.a.mark(function _callee(e){var t,n,a,c,d,f,p,m;return r.a.wrap(function _callee$(r){for(;;)switch(r.prev=r.next){case 0:if(t=e.formData,n=e.campaignId,Object(h.a)("has_form_submission_fast_lane")&&n){r.next=3;break}return r.abrupt("return",{success:!1});case 3:if(t=t?O(t):null,!Object(v.m)(t)){r.next=7;break}return Object(g.c)("Sent Empty Form Data",{campaignId:n},!0),r.abrupt("return",{success:!1});case 7:return a=Object(s.e)(Object(o.b)()),c=Object(l.b)(),r.prev=9,r.next=12,Object(i.g)({embedId:a,mappingId:n,campaignIds:[n],formData:t,clientSideContext:c});case 12:if(d=r.sent,f=d.data,p=!Object(v.m)(f.campaignTargetingResults)&&f.campaignTargetingResults[0].evaluationMatchOutcome===b.a.MATCH,m=f.relevantCampaigns.filter(function(e){return e.id===n})[0],!p){r.next=19;break}return r.next=19,Object(u.a)({conditions:f.campaignTargetingResults,campaign:m});case 19:return r.abrupt("return",{success:!0,campaignMatched:p,matchedCampaign:m});case 22:r.prev=22,r.t0=r.catch(9),Object(v.n)({data:[r.t0],type:"warn"});case 25:return r.abrupt("return",{success:!1});case 26:case"end":return r.stop()}},_callee,null,[[9,22]])}));return function collectAndQualify(t){return e.apply(this,arguments)}}()},wsRw:function(e,t,n){"use strict";n.d(t,"a",function(){return o});var a=n("QtlZ"),r=n("RKIR"),c=n("ILQF"),i=n("Hvhg"),o=function attachWidgetIntegrations(){var e=Object(i.d)(Object(a.b)(),"integrations",{});Object.keys(e).forEach(function(t){var n;r.a[t]&&(null===(n=e[t])||void 0===n?void 0:n.enabled)&&Object(c.a)({topic:"handle-host-integration",message:{config:e[t],type:t}})})}},z8n0:function(e,t,n){}}]);